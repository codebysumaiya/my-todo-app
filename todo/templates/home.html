<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>My ToDo List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .completed { background:#d4edda; border-left:6px solid #198754; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <h1 class="text-center mb-5 text-primary fw-bold">My ToDo List</h1>

    <div id="msg"></div>

    <form method="post" action="{% url 'add_todo' %}" class="mb-5">
        {% csrf_token %}
        <div class="input-group input-group-lg">
            <input type="text" name="title" class="form-control" placeholder="Add a new task..." required>
            <button class="btn btn-success">Add</button>
        </div>
    </form>

    {% for todo in todos %}
    <div class="card mb-3 {% if todo.completed %}completed{% endif %}" id="t{{ todo.pk }}">
        <div class="card-body d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <input type="checkbox" class="form-check-input me-3" style="width:30px;height:30px"
                       {% if todo.completed %}checked{% endif %}
                       onclick="toggle({{ todo.pk }})">
                <h5 class="mb-0 {% if todo.completed %}text-success fw-bold{% else %}text-dark{% endif %}">
                    {{ todo.title }}
                </h5>
            </div>
            <div>
                {% if not todo.completed %}
                    <a href="{% url 'update_todo' todo.pk %}" class="btn btn-warning btn-sm me-2">Edit</a>
                {% endif %}
                <a href="{% url 'delete_todo' todo.pk %}" class="btn btn-danger btn-sm">Delete</a>
            </div>
        </div>
    </div>
    {% empty %}
    <p class="text-center text-center text-muted fs-4">No tasks yet!</p>
    {% endfor %}
</div>

<script>
async function toggle(id) {
    const res = await fetch(`/toggle/${id}/`, {
        headers: {'X-Requested-With': 'XMLHttpRequest'}
    });
    const data = await res.json();

    const card = document.getElementById('t' + id);
    const text = card.querySelector('h5');

    if (data.completed) {
        card.classList.add('completed');
        text.classList.add('text-success', 'fw-bold');
    } else {
        card.classList.remove('completed');
        text.classList.remove('text-success', 'fw-bold');
    }

    document.getElementById('msg').innerHTML = `
        <div class="alert alert-success alert-dismissible fade show">
            ${data.message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>